import {
    _ as Oe,
    __tla as Pe
} from "./index-71666e05.js";

import {
    b_ as De,
    u as Ue,
    aa as Ae,
    p as Ee,
    w as Ne,
    r as n,
    e as I,
    a as t,
    f as qe,
    o as f,
    c as j,
    t as _,
    v as h,
    k as r,
    l as o,
    I as Be,
    z as R,
    F as q,
    y as le,
    C as S,
    B,
    H as Ke,
    D as K,
    m as Me,
    A as V,
    G as F,
    _ as He,
    J as Ge,
    P as Je,
    ab as Le,
    ac as Xe,
    Z as Ye,
    M as Ze,
    s as $e,
    __tla as Qe
} from "./index-6c08ea4c.js";

import We, {
    __tla as ea
} from "./ComTask-4d1891dc.js";

import aa, {
    __tla as ta
} from "./TestingSetting-addeb7eb.js";

import ra, {
    __tla as la
} from "./TaskStageDialog-d5f6179c.js";

import {
    n as sa,
    o as oa,
    q as ca,
    r as ia,
    d as na,
    s as _a,
    __tla as ua
} from "./project-51c056b9.js";

import {
    b as da,
    D as pa,
    __tla as ma
} from "./dict-c5825220.js";

import {
    _ as fa
} from "./_plugin-vue_export-helper-1b428a4d.js";

import {
    a as ya,
    b as va,
    E as ha,
    __tla as ka
} from "./index-5adb716b.js";

import {
    __tla as wa
} from "./Editor-ef737d2a.js";

import {
    __tla as ba
} from "./Editor.vue_vue_type_style_index_1_scoped_83b80ee8_lang-964690b9.js";

import {
    __tla as xa
} from "./style.css_vue_type_style_index_0_src_true_lang-90967dd2.js";

import {
    __tla as Ia
} from "./file-e038b35d.js";

import "./file_题-23882218.js";

import {
    __tla as ga
} from "./addResource-cf3ece02.js";

import {
    __tla as Ta
} from "./index.vue_vue_type_script_setup_true_name_ResourcePreview_lang-62b68757.js";

import {
    __tla as Ca
} from "./index.es-14d10e28.js";

import {
    __tla as ja
} from "./project-file-a2b4fd07.js";

import {
    __tla as Ra
} from "./index-c4ca0ced.js";

import {
    __tla as Sa
} from "./index-993301ca.js";

import {
    __tla as Va
} from "./index-1024512a.js";

import "./tree-05ea8e09.js";

import {
    __tla as Fa
} from "./DeptTag-1be092ce.js";

import {
    __tla as za
} from "./index-ef4d146e.js";

import {
    __tla as Oa
} from "./index-a34a73bc.js";

import "./file_HTML-65451e1b.js";

import {
    __tla as Pa
} from "./library-c2ecc5ca.js";

import "./file.data-794ea5d0.js";

import {
    __tla as Da
} from "./formatTime-de6f1520.js";

import {
    __tla as Ua
} from "./ChooseKt-d4c6a4b8.js";

import {
    __tla as Aa
} from "./codeRepository-027fddde.js";

import {
    __tla as Ea
} from "./TaskProcess-16c765c3.js";

import {
    __tla as Na
} from "./index-3a269d1c.js";

import {
    __tla as qa
} from "./UploadMdBtns-d6f91a58.js";

import {
    __tla as Ba
} from "./TaskDemand-6539e5b4.js";

import {
    __tla as Ka
} from "./ModulesChoose-34e6a0e7.js";

import {
    __tla as Ma
} from "./TaskDevelop-553c5c72.js";

import {
    __tla as Ha
} from "./TaskTesting-c5f296e2.js";

import {
    __tla as Ga
} from "./ComChooseCodeFile-fe23b12d.js";

import {
    __tla as Ja
} from "./judge-7c842b3d.js";

let se, La = Promise.all([ (() => {
    try {
        return Pe;
    } catch {}
})(), (() => {
    try {
        return Qe;
    } catch {}
})(), (() => {
    try {
        return ea;
    } catch {}
})(), (() => {
    try {
        return ta;
    } catch {}
})(), (() => {
    try {
        return la;
    } catch {}
})(), (() => {
    try {
        return ua;
    } catch {}
})(), (() => {
    try {
        return ma;
    } catch {}
})(), (() => {
    try {
        return ka;
    } catch {}
})(), (() => {
    try {
        return wa;
    } catch {}
})(), (() => {
    try {
        return ba;
    } catch {}
})(), (() => {
    try {
        return xa;
    } catch {}
})(), (() => {
    try {
        return Ia;
    } catch {}
})(), (() => {
    try {
        return ga;
    } catch {}
})(), (() => {
    try {
        return Ta;
    } catch {}
})(), (() => {
    try {
        return Ca;
    } catch {}
})(), (() => {
    try {
        return ja;
    } catch {}
})(), (() => {
    try {
        return Ra;
    } catch {}
})(), (() => {
    try {
        return Sa;
    } catch {}
})(), (() => {
    try {
        return Va;
    } catch {}
})(), (() => {
    try {
        return Fa;
    } catch {}
})(), (() => {
    try {
        return za;
    } catch {}
})(), (() => {
    try {
        return Oa;
    } catch {}
})(), (() => {
    try {
        return Pa;
    } catch {}
})(), (() => {
    try {
        return Da;
    } catch {}
})(), (() => {
    try {
        return Ua;
    } catch {}
})(), (() => {
    try {
        return Aa;
    } catch {}
})(), (() => {
    try {
        return Ea;
    } catch {}
})(), (() => {
    try {
        return Na;
    } catch {}
})(), (() => {
    try {
        return qa;
    } catch {}
})(), (() => {
    try {
        return Ba;
    } catch {}
})(), (() => {
    try {
        return Ka;
    } catch {}
})(), (() => {
    try {
        return Ma;
    } catch {}
})(), (() => {
    try {
        return Ha;
    } catch {}
})(), (() => {
    try {
        return Ga;
    } catch {}
})(), (() => {
    try {
        return Ja;
    } catch {}
})() ]).then(async () => {
    let M, H, G, J, L, X, Y;
    M = {
        class: "task-left-show"
    }, H = {
        class: "task-left"
    }, G = {
        class: "left-title"
    }, J = {
        class: "search-box"
    }, L = {
        class: "tree-box pr-10px"
    }, X = {
        class: "task-right relative"
    }, Y = {
        class: "right-save-btns"
    }, se = fa({
        __name: "ProjectTask",
        props: {
            projectId: {
                type: String,
                default: ""
            },
            environment: {
                type: Number,
                default: 0
            },
            codeRepository: {
                type: Object,
                default: () => ({})
            }
        },
        setup(oe, {
            expose: ce
        }) {
            const ie = De(), ne = Ue(), {
                t: Z
            } = Ae(), y = Ee(), u = oe;
            Ne(() => u.codeRepository, () => {}, {
                deep: !0,
                immediate: !0
            });
            const d = n(), g = n(), _e = I(() => {
                let e = da(pa.EXP_TASK_TYPE);
                return u.environment !== 15 ? e.filter(a => [ 1, 2 ].indexOf(a.value) >= 0) : e.filter(a => [ 3, 4, 5, 6 ].indexOf(a.value) >= 0);
            }), b = I(() => u.projectId), z = I(() => u.environment), p = n("任务信息"), ue = I(() => [ "任务信息", ...t(z) === 5 ? [ "评测设置" ] : [] ]), $ = I(() => t(d.value.formData).type !== 1 && s.value === 2 || s.value === 1), O = n(!1), P = n(!1), s = n(0), m = n(), D = n([]), Q = n(), k = n({
                keywords: "",
                taskType: ""
            }), U = n(), x = n([]), c = n({}), de = n({
                children: "children",
                label: "name",
                isLeaf: (e, a) => e.classify === 2,
                class: (e, a) => (e.classify === 2 ? "task-item" : "task-stage") + (e.type === 2 ? " task-result " : "") + (e.id === t(c).id ? " is-active-node" : "") + ` level-${a.level}`
            });
            function pe() {
                let e = t(c), a = ne.resolve({
                    name: "ProjectActualCombatIndex",
                    query: {
                        module: ie.getProjectBaseUrl === "exp" ? "2" : "1",
                        environment: u.environment,
                        projectId: b.value,
                        isTesting: "1",
                        taskId: e.id,
                        studentId: ""
                    }
                });
                window.open(a.href, "_blank");
            }
            function me() {
                P.value = !P.value;
            }
            function fe() {
                O.value = !0;
            }
            function ye() {
                O.value = !1;
            }
            const ve = e => {
                var a, i;
                switch (m.value && (m.value.scrollTop = 0), s.value = 0, e) {
                  case 1:
                    (a = U.value) == null || a.open("create");
                    break;

                  case 2:
                    s.value = 1, p.value = "任务信息", (i = d.value) == null || i.initForm("create", null), 
                    c.value = {};
                }
            }, A = (e, a) => {
                var i;
                switch (m.value && (m.value.scrollTop = 0), s.value = 0, e) {
                  case "create":
                    s.value = 1, d.value.initForm("create", null), c.value = a;
                    break;

                  case "update":
                    a.classify === 1 ? (i = U.value) == null || i.open(e, a.id) : (s.value = 2, 
                    p.value = "任务信息", d.value.initForm("update", a.id), g.value.initForm("update", a.id));
                    break;

                  case "delete":
                    a.classify === 1 ? he(a.id) : ke(a.id);
                }
            }, he = async e => {
                try {
                    await y.delConfirm(), await sa(e), y.success(Z("common.delSuccess")), 
                    T();
                } catch {}
            }, ke = async e => {
                try {
                    await y.delConfirm(), await oa(e), y.success(Z("common.delSuccess")), 
                    T();
                } catch {}
            }, W = async e => {
                if (p.value === "评测设置") we(e); else try {
                    if (!d || !await d.value.validate()) return;
                    try {
                        const a = t(d.value.formData);
                        if (s.value === 1) {
                            let i = {
                                ...a,
                                projectId: t(b),
                                taskStageId: t(c).parentId || t(c).id
                            };
                            await ca(i), y.success("操作成功"), c.value = {}, m.value.scrollTop = 0, 
                            s.value = 0;
                        } else await ia({
                            ...a,
                            projectId: t(b)
                        }), y.success("操作成功"), c.value = {}, m.value.scrollTop = 0, 
                        s.value = 0;
                        await E(), e && e();
                    } finally {}
                } catch {}
            }, we = async e => {
                try {
                    await g.value.saveNow(() => {
                        y.success("操作成功"), c.value = {}, s.value = 0, E(), e && e();
                    });
                } catch {}
            };
            async function T() {
                c.value = {}, await E();
            }
            const be = (e, a) => {
                m.value && (m.value.scrollTop = 0), s.value = 0, c.value = e, e.classify === 2 && (s.value = 2, 
                p.value = "任务信息", d.value.initForm("update", e.id), g.value.initForm("update", e.id));
            }, C = () => {
                var e;
                (e = Q.value) == null || e.filter(t(k));
            }, xe = (e = {
                keywords: "",
                taskType: ""
            }, a) => e.keywords ? e.taskType ? a.type == e.taskType && a.name.includes(e.keywords) : a.name.includes(e.keywords) : !e.taskType || a.type == e.taskType, Ie = () => {
                C();
            }, E = async () => {
                k.value = {
                    keywords: "",
                    taskType: ""
                }, na(u.projectId).then(e => {
                    D.value = e || [];
                }), t(z) === 5 && _a(u.projectId).then(e => {
                    x.value = e || [];
                });
            }, N = async (e = 1) => {
                if (u.projectId) await T(); else {
                    if (e === 5) return;
                    setTimeout(() => {
                        N(e + 1);
                    }, 500);
                }
            };
            return ce({
                initTasks: N,
                errEvaluationTaskIds: x,
                rightStatus: s,
                treeData: D,
                handleSaveTask: W
            }), qe(() => {
                N();
            }), (e, a) => {
                var ae;
                const i = He, w = Ge, ee = ya, ge = va, Te = ha, Ce = Je, je = Le, Re = Xe, Se = Ye, Ve = Ze, Fe = $e, ze = Oe;
                return f(), j("div", {
                    class: R([ "task-cont", t(P) ? "hide-left" : "" ])
                }, [ _("div", M, [ _("div", H, [ _("div", G, [ h(" 阶段/任务 "), r(Te, {
                    teleported: !1,
                    trigger: "hover",
                    class: "add-btn",
                    onCommand: ve
                }, {
                    dropdown: o(() => [ r(ge, null, {
                        default: o(() => [ r(ee, {
                            command: 1
                        }, {
                            default: o(() => [ h("新建阶段") ]),
                            _: 1
                        }), r(ee, {
                            command: 2
                        }, {
                            default: o(() => [ h("新建任务") ]),
                            _: 1
                        }) ]),
                        _: 1
                    }) ]),
                    default: o(() => [ r(w, {
                        type: "primary",
                        size: "default",
                        class: "!px-10px"
                    }, {
                        default: o(() => [ r(i, {
                            icon: "ep:plus",
                            class: "mr-5px"
                        }), h(" 新建 ") ]),
                        _: 1
                    }) ]),
                    _: 1
                }) ]), _("div", J, [ r(Ce, {
                    size: "large",
                    modelValue: t(k).keywords,
                    "onUpdate:modelValue": a[0] || (a[0] = l => t(k).keywords = l),
                    placeholder: "请输入关键字",
                    onKeyup: Be(C, [ "enter" ]),
                    onClear: C,
                    onFocus: fe,
                    onBlur: ye,
                    class: R([ "left search-keywords !w-160px", t(O) ? "is-focus" : "" ]),
                    clearable: ""
                }, {
                    append: o(() => [ r(i, {
                        icon: "ep:search",
                        class: "pointer",
                        onClick: C
                    }) ]),
                    _: 1
                }, 8, [ "modelValue", "class" ]), r(Re, {
                    size: "large",
                    onChange: Ie,
                    modelValue: t(k).taskType,
                    "onUpdate:modelValue": a[1] || (a[1] = l => t(k).taskType = l),
                    placeholder: "任务类型",
                    clearable: "",
                    class: "left search-item ml-10px !w-100px"
                }, {
                    default: o(() => [ (f(!0), j(q, null, le(t(_e), l => (f(), S(je, {
                        key: l.value,
                        label: l.label,
                        value: l.value
                    }, null, 8, [ "label", "value" ]))), 128)) ]),
                    _: 1
                }, 8, [ "modelValue" ]) ]), _("div", L, [ r(Se, {
                    data: t(D),
                    props: t(de),
                    onNodeClick: be,
                    ref_key: "treeRef",
                    ref: Q,
                    class: "task-tree",
                    "default-expand-all": "",
                    "filter-node-method": xe,
                    "node-key": "id",
                    indent: 12
                }, {
                    default: o(({
                        node: l,
                        data: v
                    }) => {
                        var te;
                        return [ _("div", {
                            class: R([ "custom-tree-node", t(x).indexOf(v.id) < 0 ? "" : "err-item" ])
                        }, [ h(B(l.level === 2 ? (((te = l.parent.data) == null ? void 0 : te.sort) || "0") + "-" + v.sort || "1" : v.sort || "0") + ".  " + B(l.label) + " ", 1), _("div", {
                            class: "tree-btns-box",
                            onClick: a[2] || (a[2] = Ke(() => {}, [ "stop" ]))
                        }, [ v.classify === 1 ? (f(), S(w, {
                            key: 0,
                            link: "",
                            type: "primary",
                            onClick: re => A("create", v)
                        }, {
                            default: o(() => [ r(i, {
                                icon: "ep:plus"
                            }) ]),
                            _: 2
                        }, 1032, [ "onClick" ])) : K("", !0), r(w, {
                            link: "",
                            type: "primary",
                            class: "!ml-4px",
                            onClick: re => A("update", v)
                        }, {
                            default: o(() => [ r(i, {
                                icon: "ep:edit"
                            }) ]),
                            _: 2
                        }, 1032, [ "onClick" ]), r(w, {
                            link: "",
                            type: "danger",
                            class: "!ml-4px",
                            onClick: re => A("delete", v)
                        }, {
                            default: o(() => [ r(i, {
                                icon: "ep:delete"
                            }) ]),
                            _: 2
                        }, 1032, [ "onClick" ]) ]) ], 2) ];
                    }),
                    _: 1
                }, 8, [ "data", "props" ]) ]) ]) ]), _("div", X, [ t(s) !== 0 ? (f(), 
                j(q, {
                    key: 0
                }, [ _("div", {
                    class: "hide-left-btn",
                    onClick: me
                }, [ r(i, {
                    icon: "ep:arrow-left",
                    class: "arrow-icon",
                    color: "#fff",
                    size: 8
                }) ]), _("div", Y, [ t(s) === 2 && [ 1 ].indexOf(t(c).type) >= 0 && t(x).indexOf(t(c).id) < 0 ? (f(), 
                S(w, {
                    key: 0,
                    size: "default",
                    type: "warning",
                    onClick: pe
                }, {
                    default: o(() => [ h("模拟实战") ]),
                    _: 1
                })) : K("", !0), r(w, {
                    size: "default",
                    type: "primary",
                    onClick: a[3] || (a[3] = l => W())
                }, {
                    default: o(() => [ h("保存") ]),
                    _: 1
                }) ]), r(Fe, {
                    modelValue: t(p),
                    "onUpdate:modelValue": a[4] || (a[4] = l => Me(p) ? p.value = l : null),
                    class: "right-tabs"
                }, {
                    default: o(() => [ (f(!0), j(q, null, le(t(ue), l => (f(), S(Ve, {
                        key: l,
                        name: l,
                        disabled: t($) && l === "评测设置"
                    }, {
                        label: o(() => [ _("span", {
                            class: R([ "custom-tabs-label", l === "任务信息" || t(x).indexOf(t(c).id) < 0 || t($) ? "is-pass" : "" ])
                        }, [ _("span", null, B(l), 1), r(i, {
                            icon: "ep:warning-filled",
                            class: "warning-icon",
                            color: "red"
                        }) ], 2) ]),
                        _: 2
                    }, 1032, [ "name", "disabled" ]))), 128)) ]),
                    _: 1
                }, 8, [ "modelValue" ]) ], 64)) : K("", !0), V(_("div", {
                    class: "right-cont",
                    ref_key: "rightContRef",
                    ref: m
                }, [ V(r(We, {
                    environment: t(z),
                    ref_key: "formRef",
                    ref: d,
                    projectId: t(b)
                }, null, 8, [ "environment", "projectId" ]), [ [ F, t(p) === "任务信息" ] ]), V(r(aa, {
                    taskId: t(c).id,
                    codeRepositoryId: ((ae = u.codeRepository) == null ? void 0 : ae.codeRepositoryId) || "",
                    ref_key: "formTestingRef",
                    ref: g
                }, null, 8, [ "taskId", "codeRepositoryId" ]), [ [ F, t(p) === "评测设置" ] ]) ], 512), [ [ F, t(s) !== 0 ] ]), V(r(ze, {
                    type: "resource",
                    msg: "请在左侧选择任务编辑或新建",
                    class: "empty-box"
                }, null, 512), [ [ F, t(s) === 0 ] ]) ]), r(ra, {
                    ref_key: "taskStageDialogRef",
                    ref: U,
                    projectId: t(b),
                    onSuccess: T
                }, null, 8, [ "projectId" ]) ], 2);
            };
        }
    }, [ [ "__scopeId", "data-v-ec636769" ] ]);
});

export {
    La as __tla,
    se as default
};